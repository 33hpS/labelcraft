# üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ú–æ–π–°–∫–ª–∞–¥ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### ‚úÖ Backend (Worker)

- –î–æ–±–∞–≤–ª–µ–Ω endpoint `/api/moysklad/sync` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω endpoint `/api/moysklad/test` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω –∏–ª–∏ –ª–æ–≥–∏–Ω+–ø–∞—Ä–æ–ª—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ú–æ–π–°–∫–ª–∞–¥ –≤ –∑–∞–∫–∞–∑—ã —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ Frontend

- –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `src/lib/moysklad.ts` —Å —Ç–∏–ø–∞–º–∏ –∏ –∫–ª–∏–µ–Ω—Ç–æ–º API
- –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –≤ `src/lib/api.ts`: `testMoySkladConnection()` –∏ `syncMoySkladOrders()`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. –î–æ–±–∞–≤–∏—Ç—å UI –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Orders

–î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ú–æ–π–°–∫–ª–∞–¥" —Ä—è–¥–æ–º —Å –∏–º–ø–æ—Ä—Ç–æ–º Excel:

```tsx
// –í Orders.tsx –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è:
const [moyskladDialogOpen, setMoyskladDialogOpen] = useState(false);
const [moyskladToken, setMoyskladToken] = useState("");
const [moyskladLogin, setMoyskladLogin] = useState("");
const [moyskladPassword, setMoyskladPassword] = useState("");
const [moyskladDocType, setMoyskladDocType] = useState<
  "demand" | "customerorder"
>("customerorder");
const [moyskladSyncing, setMoyskladSyncing] = useState(false);

// –§—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
const handleMoySkladSync = async () => {
  setMoyskladSyncing(true);
  setStatus(null);

  try {
    const result = await api.syncMoySkladOrders({
      token: moyskladToken || undefined,
      login: moyskladLogin || undefined,
      password: moyskladPassword || undefined,
      documentType: moyskladDocType,
      limit: 20,
    });

    await refetchOrders();
    setStatus({
      type: "success",
      text: `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–∫–∞–∑–æ–≤: ${result.imported}`,
    });
    setMoyskladDialogOpen(false);
  } catch (error) {
    setStatus({ type: "error", text: error.message });
  } finally {
    setMoyskladSyncing(false);
  }
};

// –ò –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ UI:
<Button onClick={() => setMoyskladDialogOpen(true)} variant="outline">
  <RefreshCw className="h-4 w-4 mr-2" />
  –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ú–æ–π–°–∫–ª–∞–¥
</Button>;
```

### 2. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –ú–æ–π–°–∫–ª–∞–¥ API

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –í–æ–π–¥–∏—Ç–µ –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –ú–æ–π–°–∫–ª–∞–¥
2. –û—Ç–∫—Ä–æ–π—Ç–µ: **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ø—Ä–∞–≤–∞**
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
4. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω**
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å, –Ω–æ —ç—Ç–æ –º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ.

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: Cloudflare Worker

```bash
# –í wrangler.toml –¥–æ–±–∞–≤–∏—Ç—å:
[vars]
MOYSKLAD_TOKEN = "–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å"
MOYSKLAD_ORGANIZATION = "uuid_–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏" # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

# –ò–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:
npx wrangler secret put MOYSKLAD_TOKEN
```

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: LocalStorage (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```javascript
localStorage.setItem("moysklad_token", "–≤–∞—à_—Ç–æ–∫–µ–Ω");
// –∏–ª–∏
localStorage.setItem("moysklad_login", "–≤–∞—à_–ª–æ–≥–∏–Ω");
localStorage.setItem("moysklad_password", "–≤–∞—à_–ø–∞—Ä–æ–ª—å");
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```typescript
// –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏:
const result = await api.testMoySkladConnection({
  token: "–≤–∞—à_—Ç–æ–∫–µ–Ω",
});

if (result.connected) {
  console.log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ!", result.organizations);
} else {
  console.error("‚ùå –û—à–∏–±–∫–∞:", result.error);
}
```

### 5. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤

```typescript
const result = await api.syncMoySkladOrders({
  token: "–≤–∞—à_—Ç–æ–∫–µ–Ω",
  documentType: "customerorder", // –∏–ª–∏ 'demand' –¥–ª—è –æ—Ç–≥—Ä—É–∑–æ–∫
  limit: 20, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
});

console.log(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${result.imported} –∑–∞–∫–∞–∑–æ–≤`);
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ú–æ–π–°–∫–ª–∞–¥

**customerorder** - –ó–∞–∫–∞–∑ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
- –°–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è

**demand** - –û—Ç–≥—Ä—É–∑–∫–∞

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –¢–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–∑–∏—Ü–∏–∏

### –ß—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è

–ò–∑ –∫–∞–∂–¥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –±–µ—Ä—É—Ç—Å—è:

- **–ù–∞–∑–≤–∞–Ω–∏–µ**: `"–ó–∞–∫–∞–∑ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è ‚Ññ123 –æ—Ç 14.10.2025"`
- **–ü–æ–∑–∏—Ü–∏–∏**: –º–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞–º–∏
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: `"–ú–æ–π–°–∫–ª–∞–¥ (customerorder)"`

–ö–∞–∂–¥–∞—è –ø–æ–∑–∏—Ü–∏—è:

- **–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ**: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: –æ–∫—Ä—É–≥–ª—ë–Ω–Ω–æ–µ –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞

## API Endpoints

### POST /api/moysklad/test

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ú–æ–π–°–∫–ª–∞–¥.

**Request:**

```json
{
  "token": "eyJhbGci...",
  // –∏–ª–∏
  "login": "admin@example.com",
  "password": "password123"
}
```

**Response (—É—Å–ø–µ—Ö):**

```json
{
  "connected": true,
  "organizations": [
    {
      "id": "uuid",
      "name": "–û–û–û –†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞"
    }
  ]
}
```

**Response (–æ—à–∏–±–∫–∞):**

```json
{
  "connected": false,
  "error": "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: 401",
  "details": "..."
}
```

### POST /api/moysklad/sync

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥.

**Request:**

```json
{
  "token": "eyJhbGci...",
  "documentType": "customerorder",
  "limit": 20
}
```

**Response:**

```json
{
  "success": true,
  "imported": 5,
  "orders": [
    {
      "id": "uuid",
      "title": "–ó–∞–∫–∞–∑ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è ‚Ññ123 –æ—Ç 14.10.2025",
      "itemsCount": 10,
      "moysklad_id": "original_uuid"
    }
  ]
}
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**

- –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö Cloudflare Workers (`wrangler secret put`)
- –ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ Git
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã, –∞ –Ω–µ –ª–æ–≥–∏–Ω+–ø–∞—Ä–æ–ª—å –≤ production
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø—Ä–∞–≤–∞ —Ç–æ–∫–µ–Ω–∞ —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API –ú–æ–π–°–∫–ª–∞–¥

- –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤: 45 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 3 —Å–µ–∫—É–Ω–¥—ã
- –ú–∞–∫—Å–∏–º—É–º 1000 –ø–æ–∑–∏—Ü–∏–π –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
- –ú–∞–∫—Å–∏–º—É–º 100 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å (–ø–∞—Ä–∞–º–µ—Ç—Ä `limit`)

## Troubleshooting

### –û—à–∏–±–∫–∞ 401 Unauthorized

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω (–æ–Ω –º–æ–≥ –∏—Å—Ç–µ—á—å)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –û—à–∏–±–∫–∞ 403 Forbidden

- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
- –ù—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –ú–æ–π–°–∫–ª–∞–¥

### –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã (–ø–∞—Ä–∞–º–µ—Ç—Ä `organization`)
- –í–æ–∑–º–æ–∂–Ω–æ –Ω–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–∏–ø `demand` –≤–º–µ—Å—Ç–æ `customerorder`

### –ù–µ –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ –∏–º–µ—é—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ > 0
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É –ø–æ–∑–∏—Ü–∏–π –µ—Å—Ç—å –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

üìñ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –ú–æ–π–°–∫–ª–∞–¥:
https://dev.moysklad.ru/doc/api/remap/1.2/

üîë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏:
https://dev.moysklad.ru/doc/api/remap/1.2/#mojsklad-json-api-obschie-swedeniq-autentifikaciq

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–∫–µ–Ω–∞ –º–æ–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –∏–∑ –ú–æ–π–°–∫–ª–∞–¥ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ Excel —Ñ–∞–π–ª–æ–≤.
