# üîÑ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è Production –º–æ–¥—É–ª—è

**–î–∞—Ç–∞:** 10 –Ω–æ—è–±—Ä—è 2025  
**–¶–µ–ª—å:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

---

## üìã –ú–∏–≥—Ä–∞—Ü–∏–∏ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### 1. `005_production_workflow.sql`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ –∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

**–ß—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `production_stages` - –∫–∞—Ç–∞–ª–æ–≥ —ç—Ç–∞–ø–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `stage_transitions` - –ø–µ—Ä–µ—Ö–æ–¥—ã –∑–∞–∫–∞–∑–æ–≤ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `stage_scans` - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å–∫–∞–Ω—ã (start/finish)
- ‚úÖ View `order_current_stage` - —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
- ‚úÖ Seed –¥–∞–Ω–Ω—ã–µ: 19 —ç—Ç–∞–ø–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (–æ–±—â–∏–µ + —Ü–µ—Ö 1 + —Ü–µ—Ö 2)

**–≠—Ç–∞–ø—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞:**
- **–û–±—â–∏–µ (5):** –†–∞—Å–ø–∏–ª, –ö—Ä–æ–º–∫–∞, –°–≤–µ—Ä–ª–µ–Ω–∏–µ, –ß–ü–£, –ó–µ—Ä–∫–∞–ª–æ
- **–¶–µ—Ö 1 / –õ—é–∫—Å (8):** LED-—Ü–µ—Ö, –ö–æ—Ä–æ–±–∫–∏, –®–ª–∏—Ñ–æ–≤–∫–∞, –ì—Ä—É–Ω—Ç–æ–≤–∫–∞, –ú–∞–ª—è—Ä–∫–∞, –ü–æ–ª–∏—Ä–æ–≤–∫–∞, –°–±–æ—Ä–∫–∞, –£–ø–∞–∫–æ–≤–∫–∞
- **–¶–µ—Ö 2 / –≠–∫–æ–Ω–æ–º (6):** –®–ª–∏—Ñ–æ–≤–∫–∞, –ö–ª–µ–π, –í–∞–∫—É—É–º-–ø—Ä–µ—Å—Å, –°–±–æ—Ä–∫–∞, –£–ø–∞–∫–æ–≤–∫–∞

### 2. `006_order_progress_view.sql`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** View –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–∫–∞–∑–æ–≤

**–ß—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- ‚úÖ View `order_progress` - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É

**–ü–æ–ª—è view:**
- `order_id` - ID –∑–∞–∫–∞–∑–∞
- `order_title` - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `order_status` - –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
- `total_stages` - –í—Å–µ–≥–æ —ç—Ç–∞–ø–æ–≤
- `completed_stages` - –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤
- `progress_percentage` - –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `last_started_at` - –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–∞—Ä—Ç —ç—Ç–∞–ø–∞
- `last_completed_at` - –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

---

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Cloudflare Dashboard

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Web Console (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å D1 Console
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://dash.cloudflare.com
2. –í—ã–±—Ä–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Workers & Pages** ‚Üí **D1**
4. –ù–∞–π—Ç–∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö **`productlabelerpro`**
5. –ù–∞–∂–∞—Ç—å –Ω–∞ –Ω–µ—ë –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–µ—Ç–∞–ª–µ–π
6. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Console**

#### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 005_production_workflow.sql
1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å SQL –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞ `migrations/005_production_workflow.sql`
2. –í—Å—Ç–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ Console
3. –ù–∞–∂–∞—Ç—å **Execute**
4. –î–æ–∂–¥–∞—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ

#### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 006_order_progress_view.sql
1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å SQL –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞ `migrations/006_order_progress_view.sql`
2. –í—Å—Ç–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ Console
3. –ù–∞–∂–∞—Ç—å **Execute**
4. –î–æ–∂–¥–∞—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ

#### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞
–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å:
```sql
SELECT COUNT(*) as stages_count FROM production_stages;
-- –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 19
```

```sql
SELECT * FROM order_progress LIMIT 5;
-- –î–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ view –±–µ–∑ –æ—à–∏–±–æ–∫
```

---

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ wrangler CLI (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

#### –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
npx wrangler d1 execute productlabelerpro --file=migrations/005_production_workflow.sql --remote

npx wrangler d1 execute productlabelerpro --file=migrations/006_order_progress_view.sql --remote
```

**–§–ª–∞–≥ `--remote`** –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫ production –±–∞–∑–µ!

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ wrangler:
```bash
npx wrangler d1 execute productlabelerpro --command="SELECT COUNT(*) FROM production_stages" --remote
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ COUNT(*)      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 19            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### production_stages (19 –∑–∞–ø–∏—Å–µ–π)

| id | name | workshop | segment | sequence_order | is_active |
|----|------|----------|---------|----------------|-----------|
| st_001 | –†–∞—Å–ø–∏–ª | NULL | NULL | 1 | 1 |
| st_002 | –ö—Ä–æ–º–∫–∞ | NULL | NULL | 2 | 1 |
| st_003 | –°–≤–µ—Ä–ª–µ–Ω–∏–µ | NULL | NULL | 3 | 1 |
| st_004 | –ß–ü–£ | NULL | NULL | 4 | 1 |
| st_005 | –ó–µ—Ä–∫–∞–ª–æ (–∫—Ä–æ–º–∫–∞ + —Ä–µ–∑–∫–∞) | NULL | NULL | 5 | 1 |
| st_101 | LED-—Ü–µ—Ö | 1 | lux | 6 | 1 |
| st_102 | –ö–æ—Ä–æ–±–∫–∏ (—Ä–µ–∑–∫–∞) | 1 | lux | 7 | 1 |
| st_103 | –®–ª–∏—Ñ–æ–≤–∫–∞ | 1 | lux | 8 | 1 |
| st_104 | –ì—Ä—É–Ω—Ç–æ–≤–∫–∞ | 1 | lux | 9 | 1 |
| st_105 | –ú–∞–ª—è—Ä–∫–∞ | 1 | lux | 10 | 1 |
| st_106 | –ü–æ–ª–∏—Ä–æ–≤–∫–∞ | 1 | lux | 11 | 1 |
| st_107 | –°–±–æ—Ä–∫–∞ | 1 | lux | 12 | 0 |
| st_108 | –£–ø–∞–∫–æ–≤–∫–∞ | 1 | lux | 13 | 1 |
| st_201 | –®–ª–∏—Ñ–æ–≤–∫–∞ | 2 | econom | 14 | 1 |
| st_202 | –ö–ª–µ–π | 2 | econom | 15 | 1 |
| st_203 | (–ø—É—Å—Ç–æ) | 2 | econom | 16 | 0 |
| st_204 | –í–∞–∫—É—É–º-–ø—Ä–µ—Å—Å | 2 | econom | 17 | 1 |
| st_205 | –°–±–æ—Ä–∫–∞ | 2 | econom | 18 | 1 |
| st_206 | –£–ø–∞–∫–æ–≤–∫–∞ | 2 | econom | 19 | 1 |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `is_active=0` –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π —ç—Ç–∞–ø (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ UI)

### stage_transitions (–ø—É—Å—Ç–æ –¥–æ –ø–µ—Ä–≤–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)

–ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ QR-–∫–æ–¥–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏:
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —ç—Ç–∞–ø–∞: `status='started'`
- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏: `status='completed'`

### order_progress (view)

–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- –¢–∞–±–ª–∏—Ü–∞ `orders`
- –¢–∞–±–ª–∏—Ü–∞ `stage_transitions`
- –¢–∞–±–ª–∏—Ü–∞ `production_stages`

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞.

---

## ‚úÖ –ß—Ç–æ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. ProductionDashboard (–ú–µ–Ω–µ–¥–∂–µ—Ä)
- ‚úÖ –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
- ‚úÖ –¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
- ‚úÖ SLA –∞–ª–µ—Ä—Ç—ã (–ø—Ä–æ—Å—Ä–æ—á–∫–∏)
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø–æ —Å–µ–≥–º–µ–Ω—Ç—É/—Ü–µ—Ö—É
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ CSV —ç–∫—Å–ø–æ—Ä—Ç

### 2. ProductionOperator (–û–ø–µ—Ä–∞—Ç–æ—Ä)
- ‚úÖ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–æ–≤ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ —ç—Ç–∞–ø–æ–≤
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–∞–ø–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–∞–ø–æ–≤
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

### 3. API Endpoints
- ‚úÖ `GET /api/production/stages` - —Å–ø–∏—Å–æ–∫ —ç—Ç–∞–ø–æ–≤
- ‚úÖ `POST /api/production/scan` - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR
- ‚úÖ `GET /api/production/orders/:id/history` - –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–∞
- ‚úÖ `GET /api/production/alerts` - SLA –∞–ª–µ—Ä—Ç—ã

### 4. Cron Job
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–∫ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤ –≤ `production_alerts`

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ —ç—Ç–∞–ø–æ–≤
```bash
curl https://labelcraft.sherhan1988hp.workers.dev/api/production/stages
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: JSON —Å 19 —ç—Ç–∞–ø–∞–º–∏

### 2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑
```bash
curl -X POST https://labelcraft.sherhan1988hp.workers.dev/api/orders \
  -H "Content-Type: application/json" \
  -H "X-Role: manager" \
  -d '{
    "title": "–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑",
    "customer_name": "–¢–µ—Å—Ç",
    "segment": "lux",
    "workshop": 1,
    "quantity": 1
  }'
```

### 3. –ü—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤—ã–π —ç—Ç–∞–ø
```bash
curl -X POST https://labelcraft.sherhan1988hp.workers.dev/api/production/scan \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <JWT_TOKEN>" \
  -d '{
    "qr_code": "ORD-XXX-START-st_001",
    "operator_name": "–¢–µ—Å—Ç–æ–≤—ã–π –û–ø–µ—Ä–∞—Ç–æ—Ä"
  }'
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
```bash
curl https://labelcraft.sherhan1988hp.workers.dev/api/production/orders/<order_id>/history
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: JSON —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `CREATE TABLE IF NOT EXISTS`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `DROP VIEW IF EXISTS`
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ

### 2. Seed –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç—Å—è
```sql
DELETE FROM production_stages;
INSERT INTO production_stages ...
```
‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –ï—Å–ª–∏ —É–∂–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã custom —ç—Ç–∞–ø—ã, –æ–Ω–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `DELETE FROM production_stages;` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ.

### 3. Foreign keys
–í–∫–ª—é—á–µ–Ω—ã —á–µ—Ä–µ–∑ `PRAGMA foreign_keys=ON;`
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ stage —É–¥–∞–ª—è—Ç—Å—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ transitions (CASCADE)

### 4. –ò–Ω–¥–µ–∫—Å—ã
–°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- `idx_production_stages_order` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —ç—Ç–∞–ø–æ–≤
- `idx_transitions_order` - –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–∞
- `idx_transitions_stage` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —ç—Ç–∞–ø—É

---

## üìù SQL –∫–æ–¥ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

### 005_production_workflow.sql

```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞ migrations/005_production_workflow.sql
-- –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
-- npx wrangler d1 execute productlabelerpro --file=migrations/005_production_workflow.sql --remote
```

### 006_order_progress_view.sql

```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞ migrations/006_order_progress_view.sql
-- –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
-- npx wrangler d1 execute productlabelerpro --file=migrations/006_order_progress_view.sql --remote
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

### –ó–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```sql
-- 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–ø–æ–≤
SELECT COUNT(*) as total FROM production_stages WHERE is_active = 1;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: 17 (2 —ç—Ç–∞–ø–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã)

-- 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–∞–ø—ã –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º
SELECT segment, COUNT(*) as count 
FROM production_stages 
WHERE is_active = 1 
GROUP BY segment;
-- NULL: 5, lux: 7, econom: 5

-- 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å view order_progress
SELECT * FROM order_progress LIMIT 1;
-- –î–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ–∑ –æ—à–∏–±–æ–∫

-- 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å view order_current_stage
SELECT * FROM order_current_stage LIMIT 1;
-- –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ –µ—Å–ª–∏ –Ω–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

-- 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
SELECT name FROM sqlite_master WHERE type='index' AND tbl_name='production_stages';
-- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å: idx_production_stages_order, idx_production_stages_workshop
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [ ] –û—Ç–∫—Ä—ã—Ç Cloudflare Dashboard
- [ ] –í—ã–±—Ä–∞–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `productlabelerpro`
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `005_production_workflow.sql`
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `006_order_progress_view.sql`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–ø–æ–≤ (19 –∑–∞–ø–∏—Å–µ–π)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ view `order_progress`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ view `order_current_stage`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω API endpoint `/api/production/stages`
- [ ] –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –¥–∞—à–±–æ—Ä–¥ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ)

---

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Table already exists"
**–†–µ—à–µ–Ω–∏–µ:** –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏. –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `IF NOT EXISTS`.

### –ü—Ä–æ–±–ª–µ–º–∞: "Foreign key constraint failed"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `PRAGMA foreign_keys=ON;` –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏.

### –ü—Ä–æ–±–ª–µ–º–∞: View –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** 
```sql
DROP VIEW IF EXISTS order_progress;
-- –ó–∞—Ç–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å view
```

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞—à–±–æ—Ä–¥ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ç–∞–ø—ã
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ: `SELECT COUNT(*) FROM production_stages;`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç: `curl .../api/production/stages`
3. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R)

### –ü—Ä–æ–±–ª–µ–º–∞: Seed –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å
**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –í—Ä—É—á–Ω—É—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å INSERT statements –∏–∑ 005_production_workflow.sql
-- –ò–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –≤—Å—ë:
DROP TABLE IF EXISTS stage_scans;
DROP TABLE IF EXISTS stage_transitions;
DROP TABLE IF EXISTS production_stages;
-- –ó–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Worker –≤ Cloudflare Dashboard
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `productlabelerpro` –∞–∫—Ç–∏–≤–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–Ω–¥–∏–Ω–≥–∏ –≤ `wrangler.toml`
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –≤—ã—à–µ

---

**–°—Ç–∞—Ç—É—Å:** ‚è≥ **–û–ñ–ò–î–ê–ï–¢ –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø**  
**–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:** ‚úÖ **PRODUCTION –ú–û–î–£–õ–¨ –ü–û–õ–ù–û–°–¢–¨–Æ –§–£–ù–ö–¶–ò–û–ù–ê–õ–ï–ù**

